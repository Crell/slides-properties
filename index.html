<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<title>A Field Guide to PHProperties</title>

  <link rel="stylesheet" href="dist/reset.css">
  <link rel="stylesheet" href="dist/reveal.css">
  <!--  <link rel="stylesheet" href="dist/theme/black.css" id="theme">-->

  <link rel="stylesheet" href="custom/custom-theme.css" id="theme" />

  <!-- Theme used for syntax highlighted code -->
  <link rel="stylesheet" href="plugin/highlight/monokai.css" id="highlight-theme">

  <style>

  </style>

</head>
<body class="skin-blue">
<div class="reveal">
  <footer>
    <img src="assets/lz-logo-black.svg" alt="" />
    <span class="name">@Crell@phpc.social</span>
  </footer>
	<div class="slides">
    <section class="title">
      <h1>A Field Guide to PHProperties</h1>
    </section>

    <section id="presenter">
      <h2>Larry Garfield</h2>
      <h2><a href="https://phpc.social/@Crell">@Crell@phpc.social</a></h2>

      <div class="layout-col vcentered">
        <a href="http://bit.ly/php80"><img src="assets/exploring-php80.png" width="175px;" alt="Cover of Exploring PHP 8.0" /></a>
        <a href="https://bit.ly/fn-php"><img src="assets/thinking-functionally.png" width="175px;" alt="Cover of Thinking Functionally in PHP" /></a>

        <ul style="text-wrap: nowrap">
          <li style="margin-top: 1em;">Hire me!</li>
          <li style="margin-top: 1em;">PHP-FIG Core Committee</li>
          <li style="margin-top: 1em;">PHP Core Contributor</li>
          <li style="margin-top: 1em;">General purpose pedant</li>
          <li style="margin-top: 1em;"><a href="https://bit.ly/fn-php"><em>Thinking Functionally in PHP</em></a></li>
        </ul>
      </div>
    </section>

    <section>
      <section>
        <h2>New PHP version! (8.4)</h2>
      </section>
      <section>
        <h3>New Toys!</h3>
        <ul>
          <li class="fragment">Asymmetric visibility</li>
          <li class="fragment">Interface properties</li>
          <li class="fragment">Property hooks (accessors)</li>
          <li class="fragment">And other stuff we're not going to talk about</li>
        </ul>
        <aside class="notes">
          <ul>
            <li>Go see the change log and docs</li>
            <li>Only going to skim over the syntax, go read the docs</li>
          </ul>
        </aside>
      </section>
      <section data-auto-animate data-auto-animate-id="aviz">
        <h3>Asymmetric visibility</h3>
        <pre data-id="example-code"><code class="php font--16" data-trim data-noescape data-line-numbers>
          class Person {
              public private(set) string $fullName;

              public function __construct(
                public private(set) string $firstName,
                public private(set) string $lastName,
                public protected(set) int $age,
              ) {
                  $this->fullName = sprintf('%s %s', $this->firstName, $this->lastName);
              }

              public function update(string $first, string $last): void {
                  $this->first = $first;
                  $this->last = $last;
                  $this->fullName = sprintf('%s %s', $this->firstName, $this->lastName);
              }
          }
        </code></pre>
        <p class="fragment oversize">More flexible than <code>readonly</code></p>
        <aside class="notes">
          <ul>
            <li>Vary the read/write side independently</li>
          </ul>
        </aside>
      </section>
      <section data-auto-animate data-auto-animate-id="aviz">
        <h3>Asymmetric visibility</h3>
        <pre data-id="example-code"><code class="php font--16" data-trim data-noescape data-line-numbers>
          class Person {
              private(set) string $fullName;

              public function __construct(
                private(set) string $firstName,
                private(set) string $lastName,
                protected(set) int $age,
              ) {
                  $this->fullName = sprintf('%s %s', $this->firstName, $this->lastName);
              }

              public function update(string $first, string $last): void {
                  $this->first = $first;
                  $this->last = $last;
                  $this->fullName = sprintf('%s %s', $this->firstName, $this->lastName);
              }
          }
        </code></pre>
        <p class="oversize">Optionally omit <code>public</code></p>
      </section>
      <section data-auto-animate data-auto-animate-id="interface-props">
        <h3>Interface properties</h3>
        <pre data-id="code"><code class="php font--16" data-trim data-noescape data-line-numbers>
          interface Named {
              public string $firstName { get; }
              public string $lastName { get; }

              public string $nickname { get; set; }

              public function fullName(): string;
          }
        </code></pre>
        <p class="fragment oversize">Requires there be public read-or-write properties.</p>
        <aside class="notes">
          <ul>
            <li>Interfaces can now require properties. Read or write or both.</li>
            <li>Can satisfy the interface however you want.</li>
          </ul>
        </aside>
      </section>
      <section data-auto-animate data-auto-animate-id="interface-props">
        <h3>Interface properties</h3>
        <pre data-id="code"><code class="php font--16" data-trim data-noescape data-line-numbers>
          interface Named {
              public string $firstName { get; }
              public string $lastName { get; }

              public string $nickname { get; set; }

              public function fullName(): string;
          }

          class Person implements Named {
              public private(set) string $firstName;
              public string $lastName;
              public string $nickname;

              public function fullName(): string {
                  sprintf('%s %s', $this->firstName, $this->lastName);
              }
          }
        </code></pre>
        <aside class="notes">
          <ul>
            <li>$firstName is public read, all we need.</li>
            <li>$lastName is public read/write, which is also OK</li>
            <li>$nickname is a basic property, so works read or write.</li>
          </ul>
        </aside>
      </section>
      <section data-auto-animate data-auto-animate-id="hooks">
        <h3 data-id="anatomy-title">Property hooks (aka Accessors)</h3>
        <pre data-id="anatomy-code"><code class="php font--16" data-trim data-noescape data-line-numbers>
          class Person {
              public string $name = '' {
                  get {
                      return $this->name;
                  }
                  set(string $value) {
                      $this->name = $value;
                  }
              }
          }

          // This hasn't changed!
          $p = new Person();
          $p->name = "Larry";
          print $p->name . PHP_EOL;
        </code></pre>
        <aside class="notes">
          <ul>
            <li>Hooks intercept the read/write process</li>
            <li>Override the normal behavior with arbitrary code</li>
            <li>Same net effect as a method, but accessed through property syntax</li>
          </ul>
        </aside>
      </section>
      <section data-auto-animate data-auto-animate-id="hooks">
        <h3 data-id="anatomy-title"><code>set</code> args are optional</h3>
        <pre data-id="anatomy-code"><code class="php font--16" data-trim data-noescape data-line-numbers>
          class Person {
              public string $name = '' {
                  get {
                      return $this->name;
                  }
                  set {
                      $this->name = $value;
                  }
              }
          }

          // This hasn't changed!
          $p = new Person();
          $p->name = "Larry";
          print $p->name . PHP_EOL;
        </code></pre>
        <aside class="notes">
          <ul>
            <li>Don't need to specify the type/name of the set arg. Defaults to $value and prop type</li>
            <li>Why $value?  It's what other langs use for this.</li>
          </ul>
        </aside>
      </section>
      <section data-auto-animate data-auto-animate-id="hooks">
        <h3 data-id="anatomy-title">Short-hand <code>get</code></h3>
        <pre data-id="anatomy-code"><code class="php font--16" data-trim data-noescape data-line-numbers>
          class Person {
              public string $name = '' {
                  get => $this->name;
                  set {
                      $this->name = $value;
                  }
              }
          }

          // This hasn't changed!
          $p = new Person();
          $p->name = "Larry";
          print $p->name . PHP_EOL;
        </code></pre>
        <aside class="notes">
          <ul>
            <li>Same idea as short-closures</li>
          </ul>
        </aside>
      </section>
      <section data-auto-animate data-auto-animate-id="hooks">
        <h3 data-id="anatomy-title">Short-hand <code>set</code></h3>
        <pre data-id="anatomy-code"><code class="php font--16" data-trim data-noescape data-line-numbers>
          class Person {
              public string $name = '' {
                  get => $this->name;
                  set => $value;
              }
          }

          // This hasn't changed!
          $p = new Person();
          $p->name = "Larry";
          print $p->name . PHP_EOL;
        </code></pre>
        <aside class="notes">
          <ul>
            <li>Return value from short-set gets assigned to property.</li>
            <li>Still haven't changed any behavior in this code, but shown skeleton</li>
          </ul>
        </aside>
      </section>
      <section data-auto-animate data-auto-animate-id="hooks-why">
        <h3 data-id="title">But... why?</h3>
        <pre data-id="code"><code class="php font--16" data-trim data-noescape data-line-numbers>
          class Person {
              private(set) string $fullName;

              public function __construct(
                public string $firstName,
                public string $lastName,
                public int $age,
              ) {
                  $this->fullName = sprintf('%s %s', $this->firstName, $this->lastName);
              }
          }

          $p = new Person('James', 'Kirk');
          $p->lastName = 'garfield';
          print $p->fullName . PHP_EOL;
        </code></pre>
        <aside class="notes">
          <ul>
            <li>Now want to capitalize the first and last names automatically</li>
          </ul>
        </aside>
      </section>
      <section data-auto-animate data-auto-animate-id="hooks-why">
        <h3 data-id="title">But... why?</h3>
        <pre data-id="code"><code class="php font--16" data-trim data-noescape data-line-numbers>
          class Person {
              private(set) string $fullName {
                  get => sprintf('%s %s', $this->firstName, $this->lastName);
              }

              public function __construct(
                public string $firstName { set => ucfirst($value); },
                public string $lastName { set => ucfirst($value); },
                public int $age,
              ) {}
          }

          // The API hasn't changed!
          $p = new Person('James', 'Kirk');
          $p->lastName = 'garfield';
          print $p->fullName . PHP_EOL;
        </code></pre>
        <aside class="notes">
          <ul>
            <li>Previously, would have to use a method from the start</li>
            <li>That's a lot of extra boilerplate code.</li>
            <li>This is the reason stated in the RFC.</li>
          </ul>
        </aside>
      </section>
      <section data-auto-animate data-auto-animate-id="hooks-why">
        <h3 data-id="title">But... why?</h3>
        <pre data-id="code"><code class="php font--14" data-trim data-noescape data-line-numbers>
          class Person {
              private(set) string $fullName {
                  get => sprintf('%s %s', $this->firstName, $this->lastName);
              }

              public string $firstName {
                  set => ucfirst($value);
              },

              public string $lastName {
                  set => ucfirst($value);
              },

              public function __construct(
                string $first,
                string $last,
                public int $age,
              ) {
                  $this->firstName = $first;
                  $this->lastName = $last;
              }
          }

          // The API hasn't changed!
          $p = new Person('James', 'Kirk');
          $p->lastName = 'garfield';
          print $p->fullName . PHP_EOL;
        </code></pre>
        <aside class="notes">
          <ul>
            <li>Hooks in the constructor are OK if short, but don't have to.</li>
          </ul>
        </aside>
      </section>
      <section>
        <h2>Hooks are an escape hatch</h2>
        <ul>
          <li class="fragment">Don't use them</li>
          <li class="fragment">OK to make properties public (read or write)</li>
          <li class="fragment">Use hooks to preserve BC</li>
          <li class="fragment">No more stupid get/set methods!</li>
        </ul>
      </section>
      <section>
        <h2>If you stop here, that's OK!</h2>
        <div class="fragment">
          <img src="assets/philosoraptor-all-in-hooks.jpg" alt="What if we went all-in on hooks?">
          <h2>But could we do more...?</h2>
        </div>
      </section>
    </section>
    <section>
      <section>
        <img src="assets/morpheus-no-properties.jpg" alt="What if I told you PHP 8.3 didn't have properties at all?">
      </section>
      <section>
        <img src="assets/philosoraptor-what-is-property.jpg" alt="What even is a property?">
      </section>
      <section>
        <h2>Wikipedia answers</h2>
        <blockquote style="font-size: 1.2rem">A <em>property</em>, in some object-oriented programming languages, is a
          special sort of class member, <em>intermediate in functionality</em> between
          a <em>field</em> (or data member) and a method. The syntax for reading and writing of
          properties is like for fields, but property reads and writes are (usually)
          translated to 'getter' and 'setter' method calls." </blockquote>
        <cite><a href="https://en.wikipedia.org/wiki/Property_(programming)">Wikipedia: Property</a></cite>
        <div class="fragment">
          <blockquote style="font-size: 1.2rem; margin-block-start: 3rem;">In data hierarchy, a field (data field) is a variable in a
            record. A record, also known as a data structure, allows logically related
            data to be identified by a single name." </blockquote>
          <cite><a href="https://en.wikipedia.org/wiki/Field_(computer_science)">Wikipedia: Field (CS)</a></cite>
        </div>
        <aside class="notes">
          <ul>
            <li>This is how the terms are used in C# and Kotlin</li>
            <li>Swift calls them stored and computed properties</li>
          </ul>
        </aside>
      </section>
      <section>
        <p class="oversize">Field is a physical aspect of an object</p>
        <p class="oversize fragment">Property is a logical aspect of an object</p>
      </section>
      <section>
        <div><img src="assets/mind-blown-properties.jpg" alt="We've never had properties before now!"></div>
        <p class="fragment">This changes everything...</p>
      </section>
      <section>
        <h2>How we learned OOP in my day</h2>
        <ol>
          <li class="fragment">Fields are always private/protected</li>
          <li class="fragment">All interaction through methods!</li>
        </ol>
        <p class="fragment">Fields are data.  Methods are behavior.</p>
        <p class="fragment">You cannot enforce rules on fields if exposed.</p>
        <aside class="notes">
          <ul>
            <li>Was this you?</li>
            <li>It was me</li>
          </ul>
        </aside>
      </section>
      <section>
        <h2>What couldn't fields do?</h2>
        <dl>
          <dt class="fragment">Enforce a data type</dt>
          <dd class="fragment">They can since PHP 7.4</dd>
          <dt class="fragment">Be exposed for read without exposing arbitrary write</dt>
          <dd class="fragment"><code>readonly</code> (8.1) and <code>private(set)</code> (8.4)</dd>
          <dt class="fragment">Be counted on to exist</dt>
          <dd class="fragment">Interface properties in 8.4</dd>
          <dt class="fragment">Enforce validation rules</dt>
          <dd class="fragment">But now properties can, with hooks</dd>
          <dt class="fragment">Enforce business logic</dt>
          <dd class="fragment">But now properties can, with hooks</dd>
          <dt class="fragment">Be dynamically computed</dt>
          <dd class="fragment">But now properties can, with hooks</dd>
        </dl>
        <aside class="notes">
          <ul>
            <li>Business rules include inter-dependency</li>
          </ul>
        </aside>
      </section>
      <section>
        <img src="assets/anything-fields-properties-better.jpg" alt="Anything Fields can do Properties can do better">
      </section>
      <section>
        <p class="oversize">Join me in rethinking our assumptions</p>
      </section>
      <section>
        <blockquote>Programming languages teach you not to want what they cannot provide.</blockquote>
        <cite>&mdash;Paul Graham, <a href="https://paulgraham.com/acl.html">ANSI Common Lisp</a></cite>
        <aside class="notes">
          <ul>
            <li>Everything new feels alien at first</li>
            <li>Give yourself time with a feature before dismissing or endorsing</li>
          </ul>
        </aside>
      </section>
    </section>
    <section>
      <section>
        <h2>What is an object?</h2>
        <dl>
          <dt class="fragment">Product type</dt>
          <dd class="fragment">Named tuple of typed values. Often exposed: <code>Point(x, y)</code></dd>
          <dt class="fragment">Opaque Value objects</dt>
          <dd class="fragment">Hidden internals; <code>DateTime</code>, <code>Money</code>, <code>Request</code>; often immutable</dd>
          <dt class="fragment">Entity</dt>
          <dd class="fragment">Classic OOP academia; often field/get/set. <code>Cat extends Animal</code></dd>
          <dt class="fragment">Closures with funny syntax</dt>
          <dd class="fragment">AKA "service objects"; no data, just functions and dependencies</dd>
        </dl>
        <aside class="notes">
          <ul>
            <li>No one definition of this, either</li>
            <li>Product meaning cardinality is "product" (times) the cardinality of members</li>
            <li>Not interested in Service objects today</li>
          </ul>
        </aside>
      </section>
      <section>
        <h2>What is a Property</h2>
        <p class="oversize fragment">A Property is a logical <em>aspect</em> or <em>feature</em> of an object</p>
        <p class="fragment">Don't care about the underlying details anymore</p>
      </section>
      <section>
        <h2>Properties</h2>
        <ul>
          <li class="fragment">Ask an object about itself</li>
          <li class="fragment">Tell an object about itself</li>
        </ul>
        <aside class="notes">
          <ul>
            <li>If what you're doing is one of those, it may be a property</li>
            <li>Whether there is additional logic involved is now irrelevant!</li>
          </ul>
        </aside>
      </section>
      <section>
        <h2>For example</h2>
        <pre data-id="code"><code class="php font--16" data-line-numbers="1-2|4-5|7-8|10-11|13-14|" data-trim data-noescape>
          // What timezone is this Date in?
          $timestamp->timezone;

          // Change the timezone.
          $timestamp->timezone = new DateTimeZone('America/Chicago');

          // The ID of the object.
          $entity->id;

          // How big is this list?
          $list->size;

          // The post this comment is on.
          $comment->post;
        </code></pre>
        <p class="fragment">Are these mutable values? Computed? ¯\_(ツ)_/¯</p>
        <aside class="notes">
          <ul>
            <li>Don't think about implementation, think about conceptualization</li>
            <li>What value do the words "get" and "set" add over language syntax? None!</li>
          </ul>
        </aside>
      </section>
      <section>
        <h2 class="oversize">&lt;aside></h2>
        <p class="oversize">Pop quiz: What is the second-longest entry in the OED?</p>
        <p class="fragment oversize"><em>"get"</em></p>
        <p class="fragment oversize">Pop quiz: What is the longest entry in the OED?</p>
        <p class="fragment oversize"><em>"set"</em></p>
        <p class="fragment oversize">These words mean everything, so they mean nothing</p>
        <h2 class="oversize">&lt;/aside></h2>
        <aside class="notes">
          <ul>
            <li>Oxford English Dictionary</li>
            <li>Dozens of pages each!</li>
          </ul>
        </aside>
      </section>
    </section>
    <section>
      <section>
        <h2>Properties in action</h2>
      </section>
      <section data-auto-animate data-auto-animate-id="use-case-bc">
        <h3 data-id="title">Backward compatibility shim</h3>
        <pre data-id="code"><code class="php font--16" data-trim data-noescape data-line-numbers>
          class Person {
              private(set) string $fullName {
                  get => sprintf('%s %s', $this->firstName, $this->lastName);
              }

              public function __construct(
                public string $firstName { set => ucfirst($value); },
                public string $lastName { set => ucfirst($value); },
                public int $age,
              ) {}
          }

          // The API hasn't changed!
          $p = new Person('James', 'Kirk');
          $p->lastName = 'garfield';
          print $p->fullName . PHP_EOL;
        </code></pre>
        <aside class="notes">
          <ul>
            <li>Don't use it, just eliminate boilerplate because you could use it.</li>
          </ul>
        </aside>
      </section>
      <section data-auto-animate data-auto-animate-id="example-page">
        <h3 data-id="title">Data object interface</h3>
        <pre data-id="code"><code class="php font--16" data-trim data-noescape data-line-numbers="">
          interface Page {
              public string $title { get; }
              public string $summary { get; }
              public array $tags { get; }
              public bool $hidden { get; }
              public bool $routable { get; }
              public DateTimeImmutable $publishDate { get; }
              public DateTimeImmutable $lastModifiedDate { get; }

              public LogicalPath $path { get; }
              public PhysicalPath $physicalPath { get; }
              public string $folder { get; }
          }
        </code></pre>
        <aside class="notes">
          <ul>
            <li>All pages must have these aspects/features/properties</li>
            <li>None need be writeable!</li>
            <li>Real example from real code, only slight simplification</li>
          </ul>
        </aside>
      </section>
      <section data-auto-animate data-auto-animate-id="example-page">
        <h3 data-id="title">Data object interface</h3>
        <pre data-id="code"><code class="php font--16" data-trim data-noescape data-line-numbers="">
          interface Page {
              public string $title { get; }
              public string $summary { get; }
              public array $tags { get; }
              public bool $hidden { get; }
              public bool $routable { get; }
              public DateTimeImmutable $publishDate { get; }
              public DateTimeImmutable $lastModifiedDate { get; }

              public LogicalPath $path { get; }
              public PhysicalPath $physicalPath { get; }
              public string $folder { get; }
          }

          class PageRecord implements Page {
              public function __construct(
                  private(set) string $title,
                  private(set) string $summary,
                  private(set) DateTimeImmutable $publishDate,
                  // Implementation detail for this class.
                  private array $files,
                  // ...
              ) {}
          }
        </code></pre>
        <aside class="notes">
          <ul>
            <li>PageRecord wraps multiple files into one logical page</li>
            <li>Could also use readonly if you prefer.</li>
            <li>What would methods add?  Nothing!</li>
          </ul>
        </aside>
      </section>
      <section data-auto-animate data-auto-animate-id="example-page">
        <h3 data-id="title">Lazily computed values</h3>
        <pre data-id="code"><code class="php font--16" data-trim data-noescape data-line-numbers="|2-3">
          class PageRecord implements Page {
              // This is derived.  But how?
              public PhysicalPath $physicalPath;

              /** @param array&lt;string, File> $files */
              public function __construct(
                  private(set) array $files,
                  // ...
              ) {}
          }
        </code></pre>
        <aside class="notes">
          <ul>
            <li>Focus on PageRecord</li>
            <li>How to derive $physicalPath from files list?</li>
          </ul>
        </aside>
      </section>
      <section data-auto-animate data-auto-animate-id="example-page">
        <h3 data-id="title">Lazily computed values</h3>
        <pre data-id="code"><code class="php font--16" data-trim data-noescape data-line-numbers="|10-14|2-4|6-8">
          class PageRecord implements Page {
              private File $activeFile {
                  get => $this->activeFile ??= array_values($this->files)[0];
              }

              public PhysicalPath $physicalPath {
                  get => $this->activeFile->physicalPath;
              }

              /** @param array&lt;string, File> $files */
              public function __construct(
                  private(set) array $files,
                  // ...
              ) {}
          }
        </code></pre>
        <aside class="notes">
          <ul>
            <li>$activeFile is computed on-the-fly and cached</li>
            <li>Fully transparent</li>
            <li>Other code can use it as though it were just there.</li>
            <li>Changing definition of "Active" is one line.</li>
            <li>Could $activeFile and $physicalPath be methods? Yes, but why? They're properties of this page.</li>
          </ul>
        </aside>
      </section>
      <section data-auto-animate data-auto-animate-id="example-page">
        <h3 data-id="title">Lazily computed values</h3>
        <pre data-id="code"><code class="php font--16" data-trim data-noescape data-line-numbers="2-7,10">
          class PageRecord implements Page {
              // You need this either way, so why not use it?
              private File $activeFile;

              private function activeFile(): File {
                  return $this->activeFile ??= array_values($this->files)[0];
              }

              public PhysicalPath $physicalPath {
                  get => $this->activeFile()->physicalPath;
              }

              /** @param array&lt;string, File> $files */
              public function __construct(
                  private(set) array $files,
                  // ...
              ) {}
          }
        </code></pre>
        <aside class="notes">
          <ul>
            <li>Even as a method, still need a place to cache it.</li>
            <li>Keeping the property and method separate serves no purpose.</li>
          </ul>
        </aside>
      </section>
      <section data-auto-animate data-auto-animate-id="example-page">
        <h3 data-id="title">Postel's law</h3>
        <p><q>Be conservative in what you send,<br />be liberal in what you accept.</q></p>
        <pre data-id="code"><code class="php font--16" data-trim data-noescape data-line-numbers="|9,13|2-6">
          class PageRecord implements Page {
              private(set) LogicalPath $logicalPath {
                  set(LogicalPath|string $value) => is_string($value)
                                                    ? LogicalPath::create($value)
                                                    : $value;
              }

              public function __construct(
                  LogicalPath|string $logicalPath,
                  private(set) array $files,
                  // ...
              ) {
                  $this->logicalPath = $logicalPath;
              }
          }
        </code></pre>
        <p class="fragment">This is also a form of validation!</p>
        <aside class="notes">
          <ul>
            <li>Could use promotion here, but felt it was messy.</li>
            <li>LogicalPath::create() won't succeed unless $value is a correct string.</li>
          </ul>
        </aside>
      </section>
      <section data-auto-animate data-auto-animate-id="example-page">
        <h3 data-id="title">Database record hydration</h3>
        <pre data-id="code"><code class="php font--16" data-trim data-noescape data-line-numbers="">
          class PageRecord implements Page {
              private(set) LogicalPath $logicalPath {
                  set(LogicalPath|string $value) => is_string($value)
                                                    ? LogicalPath::create($value)
                                                    : $value;
              }

              public function __construct(
                  LogicalPath|string $logicalPath,
                  private(set) array $files,
                  // ...
              ) {
                  $this->logicalPath = $logicalPath;
              }
          }

          class PageRepository {
              public function readPage(LogicalPath $path): ?PageRecord {
                  $result = $this->conn->query(/* ... */, [$path])->queryOne();

                  return $result ? new PageRecord(...$result) : null;
              }
          }
        </code></pre>
        <aside class="notes">
          <ul>
            <li>Any upcasting of value objects happens inside PageRecord, where it belongs!</li>
            <li>LogicalPath is Stringable, so can use in the query params.</li>
            <li>This is all the read model.  What is the write model?</li>
          </ul>
        </aside>
      </section>
      <section data-auto-animate data-auto-animate-id="example-page-write">
        <h3 data-id="title">Database record derivation</h3>
        <pre data-id="code"><code class="php font--14" data-trim data-noescape data-line-numbers="">
          class PageData {
              public string $title {
                  get => $this->values(__PROPERTY__)[0];
              }

              public bool $hidden {
                  get => array_all($this->values(__PROPERTY__), static fn($x): bool => (bool)$x);
              }

              public \DateTimeImmutable $publishDate {
                  get => \max($this->values(__PROPERTY__));
              }

              public array $files {
                  get => array_map(static fn(ParsedFile $f) => $f->toFile(), $this->parsedFiles);
              }

              // ...

              /** @param array&lt;string, ParsedFile> $parsedFiles */
              public function __construct(
                  public string $logicalPath,
                  private array $parsedFiles,
              ) {}

              private function values(string $property): array {
                  return array_column($this->parsedFiles, $property);
              }
          }
        </code></pre>
        <aside class="notes">
          <ul>
            <li>Write model is all derived off of other values.</li>
            <li>Not sure if I want this slide or not...</li>
          </ul>
        </aside>
      </section>
      <section data-auto-animate data-auto-animate-id="example-request">
        <h3 data-id="title">HTTP Request / PSR-7 redux</h3>
        <pre data-id="code"><code class="php font--16" data-trim data-noescape data-line-numbers="">
          interface ServerRequestInterface {
              public function getProtocolVersion(): string;
              public function getBody(): StreamInterface;
              public function getMethod(): string;
              public function getUri(): Uri;
              public function getParsedBody(): null|array|object;
              public function getHeaders(): array;
              public function getAttributes(): array;

              public function hasHeader(string $name): bool;
              public function getHeader(string $name): array;
              public function getHeaderLine(string $name): string;
              public function getAttribute(string $name, mixed $default = null): mixed;

              // Lots of with*() methods here, off topic.
          }
        </code></pre>
        <aside class="notes">
          <ul>
            <li>with() methods don't modify in place, require args, so still methods</li>
            <li>Added types for clarity</li>
            <li>What could it look like today?</li>
          </ul>
        </aside>
      </section>
      <section data-auto-animate data-auto-animate-id="example-request">
        <h3 data-id="title">HTTP Request modern version</h3>
        <pre data-id="code"><code class="php font--16" data-trim data-noescape data-line-numbers="|2-8|10-14|11-12">
          interface ServerRequestInterface {
              public string $protocolVersion { get; }
              public StreamInterface $body { get; }
              public string $method { get; }
              public Uri $uri { get; }
              public null|array|object $parsedBody { get; }
              public array $headers { get; }
              public array $attributes { get; }

              public function hasHeader(string $name): bool;
              public function getHeader(string $name): array;
              public function getHeaderLine(string $name): string;
              public function getAttribute(string $name, mixed $default = null): mixed;

              // Lots of with*() methods here, off topic.
          }
        </code></pre>
        <aside class="notes">
          <ul>
            <li>Just change the spelling for the easy ones. Make the class readonly.</li>
            <li>These are all aspects of the request. "Properties" of it.</li>
            <li>Cannot do headers or attributes, as those have arguments.</li>
            <li>Those are an operation *on* the property.</li>
            <li>getHeader() vs getHeaderLine(): Different representations of the data, so can't have a single property.</li>
          </ul>
        </aside>
      </section>
      <section data-auto-animate data-auto-animate-id="example-request">
        <h3 data-id="title">HTTP Request modern version</h3>
        <pre data-id="code"><code class="php font--16" data-trim data-noescape data-line-numbers="7-8,16-21">
          interface ServerRequestInterface {
              public string $protocolVersion { get; }
              public StreamInterface $body { get; }
              public string $method { get; }
              public Uri $uri { get; }
              public null|array|object $parsedBody { get; }
              /** @var array&lt;string, Header> */
              public array $headers { get; }
              public array $attributes { get; }

              public function hasHeader(string $name): bool;

              // Lots of with*() methods here, off topic.
          }

          class Header {
              public array $raw { get => ... }
              public string $line { get => ... }
          }

          $value = $request->headers['user-agent']?->line;
        </code></pre>
        <aside class="notes">
          <ul>
            <li>Header has different representations, so those are separate properties.</li>
            <li>Virtual properties, do as you will.</li>
            <li>hasHeader() could be just an isset check, as above with nullsafe method.</li>
            <li>Not sold on this myself, but it's a valid option.</li>
          </ul>
        </aside>
      </section>
      <section>
        <p class="oversize">It used to be anything interesting had to be a method</p>
        <p class="oversize fragment">Now, design your API around concepts,<br>not implementation</p>
        <aside class="notes">
          <ul>
            <li>This isn't "exposing implementation".  Properties still hide implementation!</li>
            <li>Methods for no purpose but validation were exposing implementation!</li>
          </ul>
        </aside>
      </section>
      <section data-auto-animate data-auto-animate-id="example-attributeutils">
        <h3 data-id="title">Definition interfaces</h3>
        <h4>The common way</h4>
        <pre data-id="code"><code class="php font--16" data-trim data-noescape data-line-numbers="|18-24">
          interface ParseProperties {
              public function setProperties(array $properties): void;
              public function includePropertiesByDefault(): bool;
              public function propertyAttribute(): string;
          }

          class ClassWithProperties implements ParseProperties {
              public array $properties = [];

              public function __construct(
                  public readonly int $a = 0,
              ) {}

              public function setProperties(array $properties): void {
                  $this->properties = $properties;
              }

              public function includePropertiesByDefault(): bool {
                  return true;
              }

              public function propertyAttribute(): string {
                  return BasicProperty::class;
              }
          }
        </code></pre>
        <aside class="notes">
          <ul>
            <li>Methods: Stupidly verbose 90% of the time</li>
            <li>But can make the values dynamic (eg, from constructor params)</li>
          </ul>
        </aside>
      </section>
      <section data-auto-animate data-auto-animate-id="example-attributeutils">
        <h3 data-id="title">Definition interfaces</h3>
        <h4>The Laravel way</h4>
        <pre data-id="code"><code class="php font--16" data-trim data-noescape data-line-numbers="|8-10">
          interface ParseProperties {
              public function setProperties(array $properties): void;
          }

          class ClassWithProperties implements ParseProperties {
              public array $properties = [];

              // Not defined anywhere, you have to just know it.
              public bool $includeByDefault = true;
              public string $propertyAttribute = BasicProperty::class;

              public function __construct(
                  public readonly int $a = 0,
              ) {}

              public function setProperties(array $properties): void {
                  $this->properties = $properties;
              }
          }
        </code></pre>
        <aside class="notes">
          <ul>
            <li>Great, now they're mutable.</li>
            <li>No explicit definition for them.</li>
            <li>Real code from Crell/AttributeUtils</li>
          </ul>
        </aside>
      </section>
      <section data-auto-animate data-auto-animate-id="example-attributeutils">
        <h3 data-id="title">Definition interfaces</h3>
        <h4>The Symfony/Attributes way</h4>
        <pre data-id="code"><code class="php font--16" data-trim data-noescape data-line-numbers="">
          interface ParseProperties {
              public function setProperties(array $properties): void;
          }

          #[PropertiesToParse(
              includeByDefault: true,
              propertyAttribute: BasicProperty::class,
          )]
          class ClassWithProperties implements ParseProperties {
              public array $properties = [];

              public function __construct(
                  public readonly int $a = 0,
              ) {}

              public function setProperties(array $properties): void {
                  $this->properties = $properties;
              }
          }
        </code></pre>
        <aside class="notes">
          <ul>
            <li>Not mutable, out of the code flow</li>
            <li>But now need interface for behavior AND attribute for definition</li>
            <li>Definition cannot be dynamic.</li>
          </ul>
        </aside>
      </section>
      <section data-auto-animate data-auto-animate-id="example-attributeutils">
        <h3 data-id="title">Definition interfaces</h3>
        <h4>The PHP 8.4 way</h4>
        <pre data-id="code"><code class="php font--16" data-trim data-noescape data-line-numbers="|4-5,11-12">
            interface ParseProperties {
                public function setProperties(array $properties): void;

                public bool $includePropertiesByDefault { get; }
                public string $propertyAttribute { get; }
            }

          class ClassWithProperties implements ParseProperties {
              public array $properties = [];

              private(set) bool $includePropertiesByDefault = true;
              public bool $propertyAttribute => BasicProperty::class;

              public function __construct(
                  public readonly int $a = 0,
              ) {}

              public function setProperties(array $properties): void {
                  $this->properties = $properties;
              }
          }
        </code></pre>
        <aside class="notes">
          <ul>
            <li>Could use private-set or virtual prop to fulfill interface</li>
            <li></li>
          </ul>
        </aside>
      </section>
      <section data-auto-animate data-auto-animate-id="example-attributeutils">
        <h3 data-id="title">Definition interfaces</h3>
        <h4>The dynamic way</h4>
        <pre data-id="code"><code class="php font--16" data-trim data-noescape data-line-numbers="4-5,11-12,14, 16-18">
            interface ParseProperties {
                public function setProperties(array $properties): void;

                public bool $includePropertiesByDefault { get; }
                public string $propertyAttribute { get; }
            }

          class ClassWithProperties implements ParseProperties {
              public array $properties = [];

              public bool $includePropertiesByDefault { get => $this->include; }
              public bool $propertyAttribute => $this->propertiesAs;

              public function __construct(
                  public readonly int $a = 0,
                  private readonly $include = true;
                  private readonly $propertiesAs = BasicProperty::class,
              ) {}

              public function setProperties(array $properties): void {
                  $this->properties = $properties;
              }
          }
        </code></pre>
        <aside class="notes">
          <ul>
            <li>Could use private-set or virtual prop to fulfill interface</li>
            <li></li>
          </ul>
        </aside>
      </section>
    </section>

    <div style="display:none">
      * Intro
        * PHP has new features: hooks, interface props, aviz
          * Very brief example of each
        * Easy approach: don't use hooks, write less code, it's an escape hatch
        * This is OK!  If you stop here, you are not doing it wrong.
        * ... But we can go further.
      * What is a property?
      * What is an object? (Philosoraptor)
      * No one-true OOP
        * Product types: internals exposed
        * Compound types: internals hidden (eg, DateTime)
        * Logical representation (classic OOP academia)
        * Closures with funny syntax (services, internals hidden)
      * Historically: All properties private always. Couldn't do better.
      * "Language teaches you to not want what it doesn't offer." (find source)
      * Property vs Field
      * Wikipedia
        * https://en.wikipedia.org/wiki/Property_(programming)
        * https://en.wikipedia.org/wiki/Field_(computer_science)
        * C#
        * Kotlin
        * Swift
        * Others...
      * What is a property?  Depends on the type of object
        * "Make one thing do many things" (find source)
        * My def: "A visible aspect of a value."
        * Method: "An action taken on a value."
        * Must manipulating an aspect be a method?  Depends who you ask...
      * Things you CAN do with hooks
        * BC shim
        * Cached value
        * Upcasting inside a value object upcast from an array record (eg, DB hydration)

      *



    </div>

    <section id="final">
      <div class="layout-1up-2down">
        <div style="grid-area: top; margin-top: 1em;">
          <h2>Larry Garfield</h2>
          <h2><a href="https://phpc.social/@Crell">@Crell@phpc.social</a></h2>
        </div>
        <div style="grid-area: left">
          <h2>All about PHP 8!</h2>
          <p><a href="https://bit.ly/php80">https://bit.ly/php80</a></p>
          <p><a href="https://bit.ly/php80"><img src="assets/exploring-php80.png" width="175px;" alt="Cover of Exploring PHP 8.0" /></a></p>
        </div>
        <div style="grid-area: right">
          <h2>Buy my book!</h2>
          <p><a href="https://bit.ly/fn-php">https://bit.ly/fn-php</a></p>
          <p><a href="https://bit.ly/fn-php"><img src="assets/thinking-functionally.png" width="175px;" alt="Cover of Thinking Functionally in PHP" /></a></p>
        </div>
      </div>
      <h3><a href="https://www.garfieldtech.com/">https://www.garfieldtech.com/</a></h3>
    </section>
  </div>
</div>

<script src="dist/reveal.js"></script>
<script src="plugin/notes/notes.js"></script>
<script src="plugin/markdown/markdown.js"></script>
<script src="plugin/highlight/highlight.js"></script>
<script src="custom/mermaid.js"></script>

<script>
  // More info about initialization & config:
  // - https://revealjs.com/initialization/
  // - https://revealjs.com/config/
  Reveal.initialize({
    hash: true,

    // mermaid initialize config
    mermaid: {
       flowchart: {
         curve: 'linear',
       },
    },

    // Learn about plugins: https://revealjs.com/plugins/
    plugins: [ RevealMarkdown, RevealHighlight, RevealNotes, RevealMermaid ]
  });
</script>

<!-- Custom Reveal extension scripts. -->
<script src="custom/classer.js"></script>
<script src="custom/countup.js"></script>
<script src="custom/usecase.js"></script>

</body>
</html>
