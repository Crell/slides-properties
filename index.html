<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<title>A Field Guide to PHProperties</title>

  <link rel="stylesheet" href="dist/reset.css">
  <link rel="stylesheet" href="dist/reveal.css">
  <!--  <link rel="stylesheet" href="dist/theme/black.css" id="theme">-->

  <link rel="stylesheet" href="custom/custom-theme.css" id="theme" />

  <!-- Theme used for syntax highlighted code -->
  <link rel="stylesheet" href="plugin/highlight/monokai.css" id="highlight-theme">

  <style>

  </style>

</head>
<body class="skin-blue">
<div class="reveal">
  <footer>
    <img src="assets/lz-logo-black.svg" alt="" />
    <span class="name">@Crell@phpc.social</span>
  </footer>
	<div class="slides">
    <section class="title">
      <h1>A Field Guide to PHProperties</h1>
    </section>

    <section id="presenter">
      <h2>Larry Garfield</h2>
      <h2><a href="https://phpc.social/@Crell">@Crell@phpc.social</a></h2>

      <div class="layout-col vcentered">
        <a href="http://bit.ly/php80"><img src="assets/exploring-php80.png" width="175px;" alt="Cover of Exploring PHP 8.0" /></a>
        <a href="https://bit.ly/fn-php"><img src="assets/thinking-functionally.png" width="175px;" alt="Cover of Thinking Functionally in PHP" /></a>

        <ul style="text-wrap: nowrap">
          <li style="margin-top: 1em;">Hire me!</li>
          <li style="margin-top: 1em;">PHP-FIG Core Committee</li>
          <li style="margin-top: 1em;">PHP Core Contributor</li>
          <li style="margin-top: 1em;">General purpose pedant</li>
          <li style="margin-top: 1em;"><a href="https://bit.ly/fn-php"><em>Thinking Functionally in PHP</em></a></li>
        </ul>
      </div>
    </section>

    <section>
      <section>
        <h2>New PHP version! (8.4)</h2>
      </section>
      <section>
        <h3>New Toys!</h3>
        <ul>
          <li class="fragment">Asymmetric visibility</li>
          <li class="fragment">Interface properties</li>
          <li class="fragment">Property hooks (accessors)</li>
          <li class="fragment">And other stuff we're not going to talk about</li>
        </ul>
        <aside class="notes">
          <ul>
            <li>Go see the change log and docs</li>
            <li>Only going to skim over the syntax, go read the docs</li>
          </ul>
        </aside>
      </section>
      <section data-auto-animate data-auto-animate-id="aviz">
        <h3>Asymmetric visibility</h3>
        <pre data-id="example-code"><code class="php font--16" data-trim data-noescape data-line-numbers>
          class Person {
              public private(set) string $fullName;

              public function __construct(
                public private(set) string $firstName,
                public private(set) string $lastName,
                public protected(set) int $age,
              ) {
                  $this->fullName = sprintf('%s %s', $this->firstName, $this->lastName);
              }

              public function update(string $first, string $last): void {
                  $this->first = $first;
                  $this->last = $last;
                  $this->fullName = sprintf('%s %s', $this->firstName, $this->lastName);
              }
          }
        </code></pre>
        <p class="fragment oversize">More flexible than <code>readonly</code></p>
        <aside class="notes">
          <ul>
            <li>Vary the read/write side independently</li>
          </ul>
        </aside>
      </section>
      <section data-auto-animate data-auto-animate-id="aviz">
        <h3>Asymmetric visibility</h3>
        <pre data-id="code"><code class="php font--16" data-trim data-noescape data-line-numbers>
          class Person {
              private(set) string $fullName;

              public function __construct(
                private(set) string $firstName,
                private(set) string $lastName,
                protected(set) int $age,
              ) {
                  $this->fullName = sprintf('%s %s', $this->firstName, $this->lastName);
              }

              public function update(string $first, string $last): void {
                  $this->first = $first;
                  $this->last = $last;
                  $this->fullName = sprintf('%s %s', $this->firstName, $this->lastName);
              }
          }
        </code></pre>
        <p class="oversize">Optionally omit <code>public</code></p>
      </section>
      <section data-auto-animate data-auto-animate-id="interface-props">
        <h3>Interface properties</h3>
        <pre data-id="code"><code class="php font--16" data-trim data-noescape data-line-numbers>
          interface Named {
              public string $firstName { get; }
              public string $lastName { get; }

              public string $nickname { get; set; }

              public function fullName(): string;
          }
        </code></pre>
        <p class="fragment oversize">Requires there be public read-or-write properties.</p>
        <aside class="notes">
          <ul>
            <li>Interfaces can now require properties. Read or write or both.</li>
            <li>Can satisfy the interface however you want.</li>
          </ul>
        </aside>
      </section>
      <section data-auto-animate data-auto-animate-id="interface-props">
        <h3>Interface properties</h3>
        <pre data-id="code"><code class="php font--16" data-trim data-noescape data-line-numbers>
          interface Named {
              public string $firstName { get; }
              public string $lastName { get; }

              public string $nickname { get; set; }

              public function fullName(): string;
          }

          class Person implements Named {
              public private(set) string $firstName;
              public string $lastName;
              public string $nickname;

              public function fullName(): string {
                  sprintf('%s %s', $this->firstName, $this->lastName);
              }
          }
        </code></pre>
        <aside class="notes">
          <ul>
            <li>$firstName is public read, all we need.</li>
            <li>$lastName is public read/write, which is also OK</li>
            <li>$nickname is a basic property, so works read or write.</li>
          </ul>
        </aside>
      </section>
      <section data-auto-animate data-auto-animate-id="hooks">
        <h3 data-id="anatomy-title">Property hooks (aka Accessors)</h3>
        <pre data-id="anatomy-code"><code class="php font--16" data-trim data-noescape data-line-numbers>
          class Person {
              public string $name = '' {
                  get {
                      return $this->name;
                  }
                  set(string $value) {
                      $this->name = $value;
                  }
              }
          }

          // This hasn't changed!
          $p = new Person();
          $p->name = "Larry";
          print $p->name . PHP_EOL;
        </code></pre>
        <aside class="notes">
          <ul>
            <li>Hooks intercept the read/write process</li>
            <li>Override the normal behavior with arbitrary code</li>
            <li>Same net effect as a method, but accessed through property syntax</li>
          </ul>
        </aside>
      </section>
      <section data-auto-animate data-auto-animate-id="hooks">
        <h3 data-id="anatomy-title"><code>set</code> args are optional</h3>
        <pre data-id="anatomy-code"><code class="php font--16" data-trim data-noescape data-line-numbers>
          class Person {
              public string $name = '' {
                  get {
                      return $this->name;
                  }
                  set {
                      $this->name = $value;
                  }
              }
          }

          // This hasn't changed!
          $p = new Person();
          $p->name = "Larry";
          print $p->name . PHP_EOL;
        </code></pre>
        <aside class="notes">
          <ul>
            <li>Don't need to specify the type/name of the set arg. Defaults to $value and prop type</li>
            <li>Why $value?  It's what other langs use for this.</li>
          </ul>
        </aside>
      </section>
      <section data-auto-animate data-auto-animate-id="hooks">
        <h3 data-id="anatomy-title">Short-hand <code>get</code></h3>
        <pre data-id="anatomy-code"><code class="php font--16" data-trim data-noescape data-line-numbers>
          class Person {
              public string $name = '' {
                  get => $this->name;
                  set {
                      $this->name = $value;
                  }
              }
          }

          // This hasn't changed!
          $p = new Person();
          $p->name = "Larry";
          print $p->name . PHP_EOL;
        </code></pre>
        <aside class="notes">
          <ul>
            <li>Same idea as short-closures</li>
          </ul>
        </aside>
      </section>
      <section data-auto-animate data-auto-animate-id="hooks">
        <h3 data-id="anatomy-title">Short-hand <code>set</code></h3>
        <pre data-id="anatomy-code"><code class="php font--16" data-trim data-noescape data-line-numbers>
          class Person {
              public string $name = '' {
                  get => $this->name;
                  set => $value;
              }
          }

          // This hasn't changed!
          $p = new Person();
          $p->name = "Larry";
          print $p->name . PHP_EOL;
        </code></pre>
        <aside class="notes">
          <ul>
            <li>Return value from short-set gets assigned to property.</li>
            <li>Still haven't changed any behavior in this code, but shown skeleton</li>
          </ul>
        </aside>
      </section>
      <section data-auto-animate data-auto-animate-id="hooks-why">
        <h3 data-id="title">But... why?</h3>
        <pre data-id="code"><code class="php font--16" data-trim data-noescape data-line-numbers>
          class Person {
              private(set) string $fullName;

              public function __construct(
                public string $firstName,
                public string $lastName,
                public int $age,
              ) {
                  $this->fullName = sprintf('%s %s', $this->firstName, $this->lastName);
              }
          }

          $p = new Person('James', 'Kirk');
          $p->lastName = 'garfield';
          print $p->fullName . PHP_EOL;
        </code></pre>
        <aside class="notes">
          <ul>
            <li>Now want to capitalize the first and last names automatically</li>
          </ul>
        </aside>
      </section>
      <section data-auto-animate data-auto-animate-id="hooks-why">
        <h3 data-id="title">But... why?</h3>
        <pre data-id="code"><code class="php font--16" data-trim data-noescape data-line-numbers>
          class Person {
              private(set) string $fullName {
                  get => sprintf('%s %s', $this->firstName, $this->lastName);
              }

              public function __construct(
                public string $firstName { set => ucfirst($value); },
                public string $lastName { set => ucfirst($value); },
                public int $age,
              ) {}
          }

          // The API hasn't changed!
          $p = new Person('James', 'Kirk');
          $p->lastName = 'garfield';
          print $p->fullName . PHP_EOL;
        </code></pre>
        <aside class="notes">
          <ul>
            <li>Previously, would have to use a method from the start</li>
            <li>That's a lot of extra boilerplate code.</li>
            <li>This is the reason stated in the RFC.</li>
          </ul>
        </aside>
      </section>
      <section data-auto-animate data-auto-animate-id="hooks-why">
        <h3 data-id="title">But... why?</h3>
        <pre data-id="code"><code class="php font--14" data-trim data-noescape data-line-numbers>
          class Person {
              private(set) string $fullName {
                  get => sprintf('%s %s', $this->firstName, $this->lastName);
              }

              public string $firstName {
                  set => ucfirst($value);
              },

              public string $lastName {
                  set => ucfirst($value);
              },

              public function __construct(
                string $first,
                string $last,
                public int $age,
              ) {
                  $this->firstName = $first;
                  $this->lastName = $last;
              }
          }

          // The API hasn't changed!
          $p = new Person('James', 'Kirk');
          $p->lastName = 'garfield';
          print $p->fullName . PHP_EOL;
        </code></pre>
        <aside class="notes">
          <ul>
            <li>Hooks in the constructor are OK if short, but don't have to.</li>
          </ul>
        </aside>
      </section>
      <section>
        <h2>Hooks are an escape hatch</h2>
        <ul>
          <li class="fragment">Don't use them</li>
          <li class="fragment">OK to make properties public (read or write)</li>
          <li class="fragment">Use hooks to preserve BC</li>
          <li class="fragment">No more stupid get/set methods!</li>
        </ul>
        <p class="fragment bigtext"></p>
      </section>
      <section>
        <h2>If you stop here, that's OK!</h2>
        <div class="fragment">
          <img src="assets/philosoraptor-all-in-hooks.jpg" alt="What if we went all-in on hooks?">
          <h2>But could we do more...?</h2>
        </div>
      </section>
    </section>
    <section>
      <section>
        <img src="assets/morpheus-no-properties.jpg" alt="What if I told you PHP 8.3 didn't have properties at all?">
      </section>
      <section>
        <img src="assets/philosoraptor-what-is-property.jpg" alt="What even is a property?">
      </section>
      <section>
        <h2>Wikipedia answers</h2>
        <blockquote style="font-size: 1.2rem">A <em>property</em>, in some object-oriented programming languages, is a
          special sort of class member, <em>intermediate in functionality</em> between
          a <em>field</em> (or data member) and a method. The syntax for reading and writing of
          properties is like for fields, but property reads and writes are (usually)
          translated to 'getter' and 'setter' method calls." </blockquote>
        <cite><a href="https://en.wikipedia.org/wiki/Property_(programming)">Wikipedia: Property</a></cite>
        <div class="fragment">
          <blockquote style="font-size: 1.2rem; margin-block-start: 3rem;">In data hierarchy, a field (data field) is a variable in a
            record. A record, also known as a data structure, allows logically related
            data to be identified by a single name." </blockquote>
          <cite><a href="https://en.wikipedia.org/wiki/Field_(computer_science)">Wikipedia: Field (CS)</a></cite>
        </div>
        <aside class="notes">
          <ul>
            <li>This is how the terms are used in C# and Kotlin</li>
            <li>Swift calls them stored and computed properties</li>
          </ul>
        </aside>
      </section>
      <section>
        <p class="oversize">Field is a physical aspect of an object</p>
        <p class="oversize fragment">Property is a logical aspect of an object</p>
      </section>
      <section>
        <div><img src="assets/mind-blown-properties.jpg" alt="We've never had properties before now!"></div>
        <p class="fragment">This changes everything...</p>
      </section>
      <section>
        <h2>How we learned OOP in my day</h2>
        <ol>
          <li class="fragment">Fields are always private/protected</li>
          <li class="fragment">All interaction through methods!</li>
        </ol>
        <p class="fragment">Fields are data.  Methods are behavior.</p>
        <p class="fragment">You cannot enforce rules on fields if exposed.</p>
        <aside class="notes">
          <ul>
            <li>Was this you?</li>
            <li>It was me</li>
          </ul>
        </aside>
      </section>
      <section>
        <h2>What couldn't fields do?</h2>
        <dl>
          <dt class="fragment">Enforce a data type</dt>
          <dd class="fragment">They can since PHP 7.4</dd>
          <dt class="fragment">Be exposed for read without exposing arbitrary write</dt>
          <dd class="fragment"><code>readonly</code> (8.1) and <code>private(set)</code> (8.4)</dd>
          <dt class="fragment">Be counted on to exist</dt>
          <dd class="fragment">Interface properties in 8.4</dd>
          <dt class="fragment">Enforce validation rules</dt>
          <dd class="fragment">But now properties can, with hooks</dd>
          <dt class="fragment">Enforce business logic</dt>
          <dd class="fragment">But now properties can, with hooks</dd>
          <dt class="fragment">Be dynamically computed</dt>
          <dd class="fragment">But now properties can, with hooks</dd>
        </dl>
        <aside class="notes">
          <ul>
            <li>Business rules include inter-dependency</li>
          </ul>
        </aside>
      </section>
      <section>
        <img src="assets/anything-fields-properties-better.jpg" alt="Anything Fields can do Properties can do better">
      </section>
      <section>
        <p class="oversize">Join me in rethinking those guidelines</p>
      </section>
    </section>
    <section>
      <section>
        <h2>What is an object?</h2>
        <dl>
          <dt class="fragment">Product type</dt>
          <dd class="fragment">Named tuple of typed values. Values exposed, often immutable</dd>
          <dt class="fragment">Opaque Value objects</dt>
          <dd class="fragment">Hidden internals; <code>DateTime</code>, <code>Money</code>, <code>Request</code>; often immutable</dd>
          <dt class="fragment">Entity</dt>
          <dd class="fragment">Classic OOP academia; often prop/get/set combo</dd>
          <dt class="fragment">Closures with funny syntax</dt>
          <dd class="fragment">AKA "service objects"; no data, just functions and dependencies</dd>
        </dl>
        <aside class="notes">
          <ul>
            <li>No one definition of this, either</li>
            <li>Product meaning cardinality is "product" (times) the cardinality of members</li>
            <li>Not interested in Service objects today</li>
          </ul>
        </aside>
      </section>
      <section>
        <h2>What is a Property</h2>
        <p class="oversize fragment">A Property is a logical aspect of an object</p>
        <p class="fragment">Don't care about the underlying details anymore</p>
      </section>
      <section>
        <h2>Properties</h2>
        <ul>
          <li class="fragment">Ask an object about itself</li>
          <li class="fragment">Tell an object about itself</li>
        </ul>
      </section>
    </section>

    <div style="display:none">
      * Intro
        * PHP has new features: hooks, interface props, aviz
          * Very brief example of each
        * Easy approach: don't use hooks, write less code, it's an escape hatch
        * This is OK!  If you stop here, you are not doing it wrong.
        * ... But we can go further.
      * What is a property?
      * What is an object? (Philosoraptor)
      * No one-true OOP
        * Product types: internals exposed
        * Compound types: internals hidden (eg, DateTime)
        * Logical representation (classic OOP academia)
        * Closures with funny syntax (services, internals hidden)
      * Historically: All properties private always. Couldn't do better.
      * "Language teaches you to not want what it doesn't offer." (find source)
      * Property vs Field
      * Wikipedia
        * https://en.wikipedia.org/wiki/Property_(programming)
        * https://en.wikipedia.org/wiki/Field_(computer_science)
        * C#
        * Kotlin
        * Swift
        * Others...
      * What is a property?  Depends on the type of object
        * "Make one thing do many things" (find source)
        * My def: "A visible aspect of a value."
        * Method: "An action taken on a value."
        * Must manipulating an aspect be a method?  Depends who you ask...
      * Things you CAN do with hooks
        * BC shim
        * Cached value
      *



    </div>

    <section id="final">
      <div class="layout-1up-2down">
        <div style="grid-area: top; margin-top: 1em;">
          <h2>Larry Garfield</h2>
          <h2><a href="https://phpc.social/@Crell">@Crell@phpc.social</a></h2>
        </div>
        <div style="grid-area: left">
          <h2>All about PHP 8!</h2>
          <p><a href="https://bit.ly/php80">https://bit.ly/php80</a></p>
          <p><a href="https://bit.ly/php80"><img src="assets/exploring-php80.png" width="175px;" alt="Cover of Exploring PHP 8.0" /></a></p>
        </div>
        <div style="grid-area: right">
          <h2>Buy my book!</h2>
          <p><a href="https://bit.ly/fn-php">https://bit.ly/fn-php</a></p>
          <p><a href="https://bit.ly/fn-php"><img src="assets/thinking-functionally.png" width="175px;" alt="Cover of Thinking Functionally in PHP" /></a></p>
        </div>
      </div>
      <h3><a href="https://www.garfieldtech.com/">https://www.garfieldtech.com/</a></h3>
    </section>
  </div>
</div>

<script src="dist/reveal.js"></script>
<script src="plugin/notes/notes.js"></script>
<script src="plugin/markdown/markdown.js"></script>
<script src="plugin/highlight/highlight.js"></script>
<script src="custom/mermaid.js"></script>

<script>
  // More info about initialization & config:
  // - https://revealjs.com/initialization/
  // - https://revealjs.com/config/
  Reveal.initialize({
    hash: true,

    // mermaid initialize config
    mermaid: {
       flowchart: {
         curve: 'linear',
       },
    },

    // Learn about plugins: https://revealjs.com/plugins/
    plugins: [ RevealMarkdown, RevealHighlight, RevealNotes, RevealMermaid ]
  });
</script>

<!-- Custom Reveal extension scripts. -->
<script src="custom/classer.js"></script>
<script src="custom/countup.js"></script>
<script src="custom/usecase.js"></script>

</body>
</html>
